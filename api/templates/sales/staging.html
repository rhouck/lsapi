{% extends 'base.html' %}

{% load static %}

{% load widget_tweaks %}

{% block head %}
  <link rel="stylesheet" href="{% static "assets/wfl/css/jquery-ui-1.10.3.custom.min.css" %}">
{% endblock %}

{% block content %}

  <div class="row">
      <div class="col-md-3">
        <h2>{{ detail.contract.customer|title }}</h2>
      </div>
      <div class="col-md-3">
        </br></br>
        <p>{{ detail.contract.customer.email }}</p>
      </div>
      <div class="col-md-3">
        </br></br>
        <p>{{ detail.contract.customer.phone }}</p>
      </div>
  </div>

  <div class="row">
      <div class="col-md-12">
        <h4>{{ detail.contract.search.origin_code }} to {{ detail.contract.search.destination_code }}</h4>
      </div>
  </div>
  <div class="row">
      <div class="col-md-3">
        <p>Dep: {{ detail.contract.search.depart_date1 }} - {{ detail.contract.search.depart_date2 }}</p>
        <p>Ret: {{ detail.contract.search.return_date1 }} - {{ detail.contract.search.return_date2 }}</p>
      </div>
      <div class="col-md-3">
        <p>Locked Fare: {{ detail.contract.search.deposit_value }}</p>
        <p>Refund Value: {{ detail.contract.search.locked_fare }}</p>
      </div>
      <div class="col-md-3">
        <p>Departure Time: {{ detail.contract.search.depart_times }}</p>
        <p>Return Time: {{ detail.contract.search.return_times }}</p>
      </div>
      <div class="col-md-3">
        <p>Convenience: {{ detail.contract.search.nonstop }}</p>
        <p>Airlines: {{ detail.contract.search.airlines }}</p>
      </div>
  </div>


  <div class="row">
    <div class="col-md-3">
      {% if detail.exercise %}
        <h3>Exercise</h3>
      {% else %}
        <h3>Refund</h3>
      {% endif %}
    </div>
  </div>


  <div class="row">
    <div class="col-md-3">
      {% if detail.exercise %}
          <p>Selected Departure: {{ detail.dep_date }}</p>
          <p>Selected Return:    {{ detail.ret_date }}</p>
          <p>Notes: {{ detail.notes }}</p>
          <p>Flight Choice: {{ detail.flight_choice }}</p>
      {% else %}
        {% if detail.notes %}
          <p>Notes: {{ detail.notes }}</p>
        {% endif %}
        <p>CC - Last Four Digits: {{ detail.contract.cc_last_four|stringformat:"04d" }}</p>
        <p>Expiration Month: {{ detail.contract.cc_exp_month }}</p>
        <p>Expiration Year:  {{ detail.contract.cc_exp_year }}</p>
      {% endif %}
    </div>
    <div class="col-md-6">
      {% if error_message %}<p style="color: red;">{{ error_message }}</p>{% endif %}

      <form action="" method="post">
        {% csrf_token %}
        {% for field in form %}
          <div class="row">
            <div class="col-md-9">
              <div class="form-group">
                <label>{{ field.label_tag }}</label>
                {{ field|add_class:"form-control" }}
              </div>
            </div>
            <div class="col-md-3">
              {% if field.name == 'fare' %}
                </br></br>
                <div id="calc_ref" style="color: red;"></div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
        <input type="submit" class="btn btn-success btn-sm" name="Search" data-msg="Are you sure?">
        <input type="submit" class="btn btn-primary btn-sm" name="force_close" value="Force Close" data-msg="Are you sure?">
        <input type="submit" class="btn btn-danger btn-sm" name="remove" value="Remove" data-msg="Are you sure?">
      </form>
    </div>
  </div>

{% endblock %}


{% block footer %}
  <script src="{% static "assets/js/juicer.js" %}"></script>
  <script>
    var dispEl = $('#calc_ref')
    ref_val = {{ detail.contract.search.locked_fare }};
    $('#id_fare').keyup(function(){dispEl.html(((ref_val > parseInt(this.value)) ? "Refund: " + (ref_val - parseInt(this.value)) : ""));});
  </script>
{% endblock %}